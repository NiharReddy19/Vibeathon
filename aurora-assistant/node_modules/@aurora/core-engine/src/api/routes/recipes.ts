// File: packages/core-engine/src/api/routes/recipes.ts
// Purpose: Recipe CRUD endpoints (MOCK for now)

import { Router } from 'express';
import { Recipe } from '@aurora/shared';
import { logger } from '../../utils/logger';
import { v4 as uuidv4 } from 'uuid';

const router = Router();

// In-memory store for demo (Part C will use file-based storage)
const recipes: Recipe[] = [];

// GET /v1/recipes - List all recipes
router.get('/', (req, res) => {
  logger.info('Fetching all recipes');
  res.json({ ok: true, data: recipes });
});

// POST /v1/recipes - Create a new recipe
router.post('/', (req, res) => {
  const { name, description, steps } = req.body;

  if (!name || !steps || !Array.isArray(steps)) {
    return res.status(400).json({
      ok: false,
      error: 'Missing required fields: name, steps',
    });
  }

  const newRecipe: Recipe = {
    id: uuidv4(),
    name,
    description: description || '',
    steps,
    createdAt: Date.now(),
  };

  recipes.push(newRecipe);
  logger.info(`Created recipe: ${name}`, { id: newRecipe.id });

  res.json({ ok: true, data: newRecipe });
});

// DELETE /v1/recipes/:id - Delete a recipe
router.delete('/:id', (req, res) => {
  const { id } = req.params;
  const index = recipes.findIndex(r => r.id === id);

  if (index === -1) {
    return res.status(404).json({
      ok: false,
      error: 'Recipe not found',
    });
  }

  recipes.splice(index, 1);
  logger.info(`Deleted recipe: ${id}`);

  res.json({ ok: true, data: { deleted: id } });
});

export default router;
